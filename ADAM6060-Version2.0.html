<!DOCTYPE html>
<!-- saved from url=(0095)https://advdownload.advantech.com/productfile/Downloadfile1/1-2HG5MO5/ADAM6060-Version1.00.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <title>CPS - LHD 8200</title>
    <style>
      /* Bootstrap 5.3.2 Core CSS (Minimal yang dibutuhkan) */
      :root {
        --bs-blue: #0d6efd;
        --bs-indigo: #6610f2;
        --bs-purple: #6f42c1;
        --bs-pink: #d63384;
        --bs-red: #dc3545;
        --bs-orange: #fd7e14;
        --bs-yellow: #ffc107;
        --bs-green: #198754;
        --bs-teal: #20c997;
        --bs-cyan: #0dcaf0;
        --bs-black: #000;
        --bs-white: #fff;
        --bs-gray: #6c757d;
        --bs-gray-dark: #343a40;
        --bs-gray-100: #f8f9fa;
        --bs-gray-200: #e9ecef;
        --bs-gray-300: #dee2e6;
        --bs-gray-400: #ced4da;
        --bs-gray-500: #adb5bd;
        --bs-gray-600: #6c757d;
        --bs-gray-700: #495057;
        --bs-gray-800: #343a40;
        --bs-gray-900: #212529;
        --bs-primary: #0d6efd;
        --bs-secondary: #6c757d;
        --bs-success: #198754;
        --bs-info: #0dcaf0;
        --bs-warning: #ffc107;
        --bs-danger: #dc3545;
        --bs-light: #f8f9fa;
        --bs-dark: #212529;
        --bs-primary-rgb: 13, 110, 253;
        --bs-secondary-rgb: 108, 117, 125;
        --bs-success-rgb: 25, 135, 84;
        --bs-info-rgb: 13, 202, 240;
        --bs-warning-rgb: 255, 193, 7;
        --bs-danger-rgb: 220, 53, 69;
        --bs-light-rgb: 248, 249, 250;
        --bs-dark-rgb: 33, 37, 41;
        --bs-primary-text-emphasis: #052c65;
        --bs-secondary-text-emphasis: #2b2f32;
        --bs-success-text-emphasis: #0a3622;
        --bs-info-text-emphasis: #055160;
        --bs-warning-text-emphasis: #664d03;
        --bs-danger-text-emphasis: #58151c;
        --bs-light-text-emphasis: #495057;
        --bs-dark-text-emphasis: #495057;
        --bs-primary-bg-subtle: #cfe2ff;
        --bs-secondary-bg-subtle: #e2e3e5;
        --bs-success-bg-subtle: #d1e7dd;
        --bs-info-bg-subtle: #cff4fc;
        --bs-warning-bg-subtle: #fff3cd;
        --bs-danger-bg-subtle: #f8d7da;
        --bs-light-bg-subtle: #fcfcfd;
        --bs-dark-bg-subtle: #ced4da;
        --bs-primary-border-subtle: #9ec5fe;
        --bs-secondary-border-subtle: #c4c8cb;
        --bs-success-border-subtle: #a3cfbb;
        --bs-info-border-subtle: #9eeaf9;
        --bs-warning-border-subtle: #ffe69c;
        --bs-danger-border-subtle: #f1aeb5;
        --bs-light-border-subtle: #e9ecef;
        --bs-dark-border-subtle: #adb5bd;
        --bs-white-rgb: 255, 255, 255;
        --bs-black-rgb: 0, 0, 0;
        --bs-font-sans-serif: system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif,
          "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
          "Noto Color Emoji";
        --bs-font-monospace: SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        --bs-gradient: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.15),
          rgba(255, 255, 255, 0)
        );
        --bs-body-font-family: var(--bs-font-sans-serif);
        --bs-body-font-size: 1rem;
        --bs-body-font-weight: 400;
        --bs-body-line-height: 1.5;
        --bs-body-color: #212529;
        --bs-body-color-rgb: 33, 37, 41;
        --bs-body-bg: #fff;
        --bs-body-bg-rgb: 255, 255, 255;
        --bs-emphasis-color: #000;
        --bs-emphasis-color-rgb: 0, 0, 0;
        --bs-secondary-color: rgba(33, 37, 41, 0.75);
        --bs-secondary-color-rgb: 33, 37, 41;
        --bs-secondary-bg: #e9ecef;
        --bs-secondary-bg-rgb: 233, 236, 239;
        --bs-tertiary-color: rgba(33, 37, 41, 0.5);
        --bs-tertiary-color-rgb: 33, 37, 41;
        --bs-tertiary-bg: #f8f9fa;
        --bs-tertiary-bg-rgb: 248, 249, 250;
        --bs-heading-color: inherit;
        --bs-link-color: #0d6efd;
        --bs-link-color-rgb: 13, 110, 253;
        --bs-link-decoration: underline;
        --bs-link-hover-color: #0a58ca;
        --bs-link-hover-color-rgb: 10, 88, 202;
        --bs-code-color: #d63384;
        --bs-highlight-color: #212529;
        --bs-highlight-bg: #fff3cd;
        --bs-border-width: 1px;
        --bs-border-style: solid;
        --bs-border-color: #dee2e6;
        --bs-border-color-translucent: rgba(0, 0, 0, 0.175);
        --bs-border-radius: 0.375rem;
        --bs-border-radius-sm: 0.25rem;
        --bs-border-radius-lg: 0.5rem;
        --bs-border-radius-xl: 1rem;
        --bs-border-radius-xxl: 2rem;
        --bs-border-radius-2xl: var(--bs-border-radius-xxl);
        --bs-border-radius-pill: 50rem;
        --bs-box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        --bs-box-shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --bs-box-shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
        --bs-box-shadow-inset: inset 0 1px 2px rgba(0, 0, 0, 0.075);
        --bs-focus-ring-width: 0.25rem;
        --bs-focus-ring-opacity: 0.25;
        --bs-focus-ring-color: rgba(13, 110, 253, 0.25);
        --bs-form-valid-color: #198754;
        --bs-form-valid-border-color: #198754;
        --bs-form-invalid-color: #dc3545;
        --bs-form-invalid-border-color: #dc3545;
      }
      *,
      ::after,
      ::before {
        box-sizing: border-box;
      }
      @media (prefers-reduced-motion: no-preference) {
        :root {
          scroll-behavior: smooth;
        }
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      .h1,
      .h2,
      .h3,
      .h4,
      .h5,
      .h6,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-weight: 500;
        line-height: 1.2;
        color: var(--bs-heading-color);
      }
      .h1,
      h1 {
        font-size: calc(1.375rem + 1.5vw);
      }
      @media (min-width: 1200px) {
        .h1,
        h1 {
          font-size: 2.5rem;
        }
      }
      .h2,
      h2 {
        font-size: calc(1.325rem + 0.9vw);
      }
      @media (min-width: 1200px) {
        .h2,
        h2 {
          font-size: 2rem;
        }
      }
      .h3,
      h3 {
        font-size: calc(1.3rem + 0.6vw);
      }
      @media (min-width: 1200px) {
        .h3,
        h3 {
          font-size: 1.75rem;
        }
      }
      .h4,
      h4 {
        font-size: calc(1.275rem + 0.3vw);
      }
      @media (min-width: 1200px) {
        .h4,
        h4 {
          font-size: 1.5rem;
        }
      }
      .h5,
      h5 {
        font-size: 1.25rem;
      }
      .h6,
      h6 {
        font-size: 1rem;
      }
      p {
        margin-top: 0;
        margin-bottom: 1rem;
      }

      /* Custom Styles */
      :root {
        --primary-color: #1a237e;
        --secondary-color: #0d47a1;
        --warning-color: #ffa500;
        --danger-color: #ff3300;
        --background-color: #f8f9fa;
        --card-bg: #ffffff;
        --success-color: #00c853;
      }

      /* Topnav Styles */
      .topnav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: #0d2e4d;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 1000;
      }

      .topnav-left {
        display: flex;
        align-items: center;
      }

      .topnav-left h3 {
        margin: 0;
        color: #ffd43b;
        font-size: 1.5rem;
      }

      .topnav-right {
        display: flex;
        align-items: center;
      }

      .logo {
        height: 40px;
        width: auto;
        margin-left: 10px;
      }

      .nav-btn {
        background: none;
        border: none;
        color: #ffd43b;
        font-size: 1.2rem;
        cursor: pointer;
        margin-right: 10px;
      }

      .nav-btn:hover {
        color: #ffffff;
      }

      .content {
        padding-top: 80px;
      }

      .header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .status-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .status-header {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 15px;
        color: var(--primary-color);
        background-color: #ffd700;
        padding: 10px;
        border-radius: 4px;
      }

      .status-danger {
        background-color: #ff4500;
        color: white;
      }

      .status-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
        margin-top: 15px;
      }

      .status-item {
        text-align: center;
      }

      .status-light {
        width: 48px;
        height: 48px;
        transition: transform 0.2s;
      }

      .status-light:hover {
        transform: scale(1.1);
      }

      .graph-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        overflow-x: auto;
      }

      #logBox {
        width: 100%;
        height: 200px;
        margin-bottom: 10px;
        font-family: monospace;
        background-color: #f5f5f5;
        color: #333;
        border: 1px solid #ccc;
        padding: 5px;
        resize: vertical;
      }

      #saveLogBtn {
        display: block;
        margin-bottom: 10px;
        padding: 5px 10px;
        background-color: #0d6efd;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      #saveLogBtn:hover {
        background-color: #0b5ed7;
      }

      #saveStatus,
      #lastSaveTime {
        font-size: 12px;
        margin-bottom: 5px;
      }

      .footer {
        text-align: center;
        padding: 20px;
        color: var(--bs-gray-600);
      }

      /* Container Styles */
      .container {
        display: flex;
        flex: 1;
        padding: 20px;
        gap: 20px;
        margin-top: 60px; /* Memberikan ruang untuk header fixed */
        margin-bottom: 60px; /* Memberikan ruang untuk footer fixed */
        max-width: 100%;
        box-sizing: border-box;
      }

      .left-panel {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 50%; /* Menetapkan lebar panel kiri menjadi 50% */
      }

      .right-panel {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 50%; /* Menetapkan lebar panel kanan menjadi 50% */
        box-sizing: border-box;
      }

      @media (max-width: 992px) {
        .container {
          flex-direction: column;
        }

        .left-panel,
        .right-panel {
          width: 100%;
        }
      }

      .polling-info {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      h1,
      h2,
      h3,
      h4,
      h5 {
        margin: 0;
        padding: 0;
      }

      h1 {
        font-size: 1.8rem;
      }

      h4 {
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      h5 {
        color: #333;
        margin-bottom: 10px;
      }

      /* Footer Card Styles */
      .footer-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        z-index: 1000;
      }

      .footer-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin-bottom: 20px;
      }

      .footer-card {
        background: linear-gradient(135deg, #1a237e, #0d47a1);
        color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        width: 300px;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .footer-card:hover {
        transform: translateY(-5px);
      }

      .footer-card h3 {
        margin-bottom: 10px;
        font-size: 1.2rem;
      }

      .footer-card p {
        font-size: 0.9rem;
        margin-bottom: 15px;
      }

      .footer-card-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #ffd700;
      }

      .footer-copyright {
        text-align: center;
        padding: 10px 0;
        color: var(--bs-gray-600);
        background-color: #f8f9fa;
        border-top: 1px solid #dee2e6;
        font-size: 14px;
      }

      .footer-copyright p {
        margin: 2px 0;
      }
    </style>
  </head>
  <body onload="pageOnInit()">
    <div class="topnav">
      <div class="topnav-left">
        <h3>⚠️CPS (Collision Prevention System) - LHD 8200</h3>
      </div>
      <div class="topnav-right">
        <button id="refreshBtn" class="nav-btn">↻</button>
        <button id="fullscreenBtn" class="nav-btn">⛶</button>
        <img
          src="data:image/png;base64,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"
          alt="Trakindo Logo"
          class="logo"
        />
      </div>
    </div>

    <div class="container">
      <div class="left-panel">
        <div class="status-card">
          <div class="status-header">SAFE ZONE STATUS</div>
          <div class="polling-info" id="DIPOLL">Polling 0 times...</div>
          <div class="status-grid">
            <div class="status-item">
              <h5>FRONT Safe Zone</h5>
              <img id="DI0" src="" alt="0" class="status-light" />
            </div>
            <div class="status-item">
              <h5>REAR Safe Zone</h5>
              <img id="DI1" src="" alt="0" class="status-light" />
            </div>
          </div>
        </div>

        <div class="status-card">
          <div class="status-header status-danger">
            INTERRUPTION SYSTEM STATUS
          </div>
          <div class="polling-info" id="DOPOLL">Polling 0 times...</div>
          <div class="status-item">
            <h5>Parking Brake System</h5>
            <img id="DO0" src="" alt="0" class="status-light" />
          </div>
        </div>

        <div class="graph-container">
          <table id="TBL0" style="width: 100%">
            <tr>
              <td>
                <canvas id="adamCanvas"></canvas>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div class="right-panel">
        <h4 style="margin-top: 20px">System Log</h4>
        <textarea id="logBox" readonly></textarea>
        <button id="saveLogBtn" class="btn btn-primary">Save Log</button>
        <div id="saveStatus"></div>
        <div id="lastSaveTime"></div>
      </div>
    </div>

    <div class="footer-container">
      <div class="footer-copyright">
        <p>Collision Prevention System v2.0</p>
        <p>Copyright &copy; 2025 by Trakindo Technology Dept.</p>
      </div>
    </div>

    <script>
      var canvas;
      var ctx;
      var scanInterval = 1000;
      var diTotal = 2;
      var doTotal = 1;
      var padSize = 30;
      var gridSize = 16;
      var columnInc = 0;
      var stepSize = 8;
      var fontSize = 10;
      var Src, lightOffSrc;
      var diStatus;
      var doStatus;
      var cntMaxTotal, cntIndex, cntTotal;
      var diDataArray;
      var doDataArray;
      var diPolling, diPollingCount;
      var doPolling, doPollingCount;
      var diFailCount, diWaitCount;
      var doFailCount, doWaitCount;
      var maxWait = 5;
      var maxFail = 3;
      var lastAutoSaveTime = Date.now();

      // Variabel untuk mendeteksi refresh
      var isRefreshing = false;

      // Pendekatan yang lebih sederhana untuk mendeteksi refresh
      // Cek apakah ini adalah refresh
      var lastPageLoadTime = localStorage.getItem("lastPageLoadTime");
      var currentTime = new Date().getTime();

      if (lastPageLoadTime && currentTime - lastPageLoadTime < 3000) {
        // Jika waktu antara load terakhir dan sekarang kurang dari 3 detik, ini adalah refresh
        isRefreshing = true;
        console.log("Detected page refresh");
      }

      // Simpan waktu load saat ini
      localStorage.setItem("lastPageLoadTime", currentTime);

      // Tambahkan flag untuk menandai bahwa halaman sedang dimuat
      localStorage.setItem("pageIsLoading", "true");

      // Setelah halaman selesai dimuat, hapus flag
      window.addEventListener("load", function () {
        localStorage.removeItem("pageIsLoading");
      });

      // Fungsi untuk menyimpan log ke file
      function saveLogToFile(forceDownload = false) {
        var logContent = document.getElementById("logBox").value;
        if (!logContent && !forceDownload) return; // Jangan save jika kosong

        var timestamp = new Date().toISOString().replace(/[:.]/g, "-");
        var filename = "adam_log_" + timestamp + ".txt";

        // Selalu simpan ke localStorage
        try {
          localStorage.setItem("adam_last_log", logContent);
          localStorage.setItem("adam_last_log_time", timestamp);

          // Update status
          document.getElementById("lastSaveTime").innerHTML =
            "Terakhir disimpan: " +
            new Date().toLocaleTimeString() +
            " (Autosaved)";

          console.log("Log auto-saved to localStorage at " + timestamp);
        } catch (e) {
          console.error("Failed to save to localStorage:", e);
          document.getElementById("lastSaveTime").innerHTML =
            "Error saat menyimpan: " + e.message;
        }

        // Hanya download jika diminta secara eksplisit (tombol atau saat menutup browser/tab)
        // dan bukan saat refresh
        if (forceDownload && !isRefreshing) {
          // Download langsung
          var blob = new Blob([logContent], {
            type: "text/plain;charset=utf-8",
          });
          var link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = filename;
          link.click();

          // Update status
          document.getElementById("lastSaveTime").innerHTML =
            "Terakhir disimpan: " +
            new Date().toLocaleTimeString() +
            " (Downloaded)";
        }
      }

      function AdamTrend_Init() {
        diStatus = new Array(diTotal);
        doStatus = new Array(doTotal);
        Src =
          "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM3MUVBMzlENDk3MTFFQjk0QjhBQjY5RjU1MTM1QzgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM3MUVBM0FENDk3MTFFQjk0QjhBQjY5RjU1MTM1QzgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzcxRUEzN0Q0OTcxMUVCOTRCOEFCNjlGNTUxMzVDOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzcxRUEzOEQ0OTcxMUVCOTRCOEFCNjlGNTUxMzVDOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAEAAAAALAAAAAAgACAAAAP/CLrc/jDKSau9OOvNu/9gKI5kaZ5oqq5s675wLM90bd94ru987//AoHBILBqPyKRyyWw6n9CodEqtWq/YrHbL7Xq/4LB4TC6bz+i0es1uu9/wuHxOr9vv+Lx+z+/7/4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/AAMKHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8eP/yBDihxJsqTJkyhTqlzJsqXLlzBjypxJs6bNmzhz6tzJs6fPn0CDCh1KtKjRo0iTKl3KtKnTp1CjSp1KtarVq1izat3KtavXr2DDih1LtqzZs2jTql3Ltq3bt3Djyp1Lt67du3jz6t3Lt6/fv4ADCx5MuLDhw4gTK17MuLHjx5AjS55MubLly5gza97MubPnz6BDix5NurTp06hTq17NurXr17Bjy55Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjS59Ovbr169iza9/Ovbv37+DDix9Pvrz58+jTq1/Pvr379/Djy59Pv779+/jz69/Pv7///wAGKOCABBZo4IEIJqjgggw26OCDEEYo4YQUVmjhhRhmqOGGHHbo4YcghijiiCSWaOKJKKao4oostujiizDGKOOMNNZo44045qjjjjz26OOPQAYp5JBEFmnkkUgmqeSSTDbp5JNQRinllFRWaeWVWGap5ZZcdunll2CGKeaYZJZp5plopqnmmmy26eabcMYp55x01mnnnXjmqeeefPbp55+ABirooIQWauihiCaq6KKMNuroo5BGKumklFZq6aWYZqrpppx26umnoIYq6qiklmrqqaimquqqrLbq6quwxirrrLTWauutuOaq66689urrr8AGK+ywxBZr7LHIJqvsssw26+yz0EYr7bTUVmvttdhmq+223Hbr7bfghivuuOSWa+656Kar7rrstuvuu/DGK++89NZr77345qvvvvz26++/AAcs8MAEF2zwwQgnrPDCDDfs8MMQRyzxxBRXbPHFGGes8cYcd+zxxyCHLPLIJJds8skop6zyyiy37PLLMMcs88w012zzzTjnrPPOPPfs889ABy300EQXbfTRSCet9NJMN+3001BHLfXUVFdt9dVYZ6311lx37fXXYIct9thkl2322WinrfbabLft9ttwxy333HTXbffdeOet99589+3334AHLvjghBdu+OGIJ6744ow37vjjkEcu+eSUV2755ZhnrvnmnHfu+eeghy766KSXbvrpqKeu+uqst+7667DHLvvstNdu++2456777rz37vvvwAcv/PDEF2/88cgnr/zyzDfv/PPQRy/99NRXb/312Gev/fbcd+/99+CHL/745Jdv/vnop6/++uy37/778Mcv//z012///fjnr//+/Pfv//8ADKAAB0jAAhrwgAhMoAIXyMAGOvCBEIygBCdIwQpa8IIYzKAGN8jBDnrwgyAMoQhHSMISmvCEKEyhClfIwha68IUwjKEMZ0jDGtrwhjjMoQ53yMMe+vCHQAyiEIdIxCIa8YhITKISl8jEJjrxiVCMohSnSMUqWvGKWMyiFrfIxS568YtgDKMYx0jGMprxjGhMoxrXyMY2uvGNcIyjHOdIxzra8Y54zKMe98jHPvrxj4AMpCAHSchCGvKQiEykIhfJyEY68pGQjKQkJ0nJSlrykpjMpCY3yclOevKToAylKEdJylKa8pSoTKUqV8nKVrrylbCMpSxnScta2vKWuMylLnfJy1768pfADKYwh0nMYhrzmMhMpjKXycxmOvOZ0IymNKdJzWpa85rYzKY2t8nNbnrzm+AMpzjHSc5ymvOc6EynOtfJzna6853wjKc850nPetrznvjMpz73yc9++vOfAA2oQAdK0IIa9KAITahCF8rQhjr0oRCNqEQnStGKWvSiGM2oRjfK0Y569KMgDalIR0rSkpr0pChNqUpXytKWuvSlMI2pTGdK05ra9KY4zalOd8rTnvr0p0ANqlCHStSiGvWoSE2qUpfK1KY69alQjapUp0rVqlr1qljNqla3ytWuevWrYA2rWMdK1rKa9axoTata18rWtrr1rXCNq1znSte62vWueM2rXvfK17769a+ADaxgB0vYwhr2sIhNrGIXy9jGOvaxkI2sZCdL2cpa9rKYzaxmN8vZznr2s6ANrWhHS9rSmva0qE2talfL2ta69rWwja1sZ0vb2tr2trjNrW53y9ve+va3wA2ucIdL3OIa97jITa5yl8vc5jr3udCNrnSnS93qWve62M2udrfL3e5697vgDa94x0ve8pr3vOhNr3rXy972uve98I2vfOdL3/ra9774za9+98vf/vr3vwAOsIAHTOACG/jACE6wghfM4AY7+MEQjrCEJ0zhClv4whjOsIY3zOEOe/jDIA6xiEdM4hKb+MQoTrGKV8ziFrv4xTCOsYxnTOMa2/jGOM6xjnfM4x77+MdADrKQh0zkIhv5yEhOspKXzOQmO/nJUI6ylKdM5Spb+cpYzrKWt8zlLnv5y2AOs5jHTOYym/nMaE6zmtfM5ja7+c1wjrOc50znOtv5znjOs573zOc++/nPgA60oAdN6EIb+tCITrSiF83oRjv60ZCOtKQnTelKW/rSmM60pjfN6U57+tOgDrWoR03qUpv61KhOtapXzetWu/rVsI61rGdN61rb+ta4zrWud83rXvv618AOtrCHTexiG/vYyE62spfN7GY7+9nQjra0p03talv72tjOtra3ze1ue/vb4A63uMdN7nKb+9zoTre6183udrv73fCOt7znTe962/ve+M63vvfN7377+98AD7jAB07wghv84AhPuMIXzvCGO/zhEI+4xCdO8Ypb/OIYz7jGN87xjnv84yAPuchHTvKSm/zkKE+5ylfO8pa7/OUwj7nMZ07zmtv85jjPuc53zvOe+/znQA+60IdO9KIb/ehIT7rSl870pjv96VCPutSnTvWqW/3qWM+61rfO9a57/etgD7vYx072spv97GhPu9rXzva2u/3tcI+73OdO97rb/e54z7ve9873vvv974APvOAHT/jCG/7wiE+84hfP+MY7/vGQj7zkJ0/5ylv+8pjPvOY3z/nOe/7zoA+96EdP+tKb/vSoT73qV8/61rv+9bCPvexnT/va2/72uM+97nfP+977/vfAD77wh0/84hv/+MhPvvKXz/zmO//50I++9KdP/epb//rYz772t8/97nv/++APv/jHT/7ym//86E+/+tfP/va7//3wj7/850//+tv//vjPv/73z//++///ABiAApiACliACJiACriADNiADviAEBiBEjiBFFiBFniBGJiBGriBHNiBHviBIBiCIjiCJFiCJniCKJiCKriCLNiCLviCMBiDMjiDNFiDNniDOJiDOriDPNiDPviDQBiEQjiERFiERniESJiESriETNiETviEUBiFUjiFVFiFVniFWJiFWriFXNiFXviFYBiGYjiGZFiGZniGaJiGariGbNiGbviGcBiHcjiHdFiHdniHeJiHeriHfNiHfviHgBiIgjiIhFiIhniIiJiIiriIjNiIjviIkBiJkjiJlFiJlniJmJiJmriJnNiJnviJoBiKojiKpFiKpniKqJiKqriKrNiKrviKsBiLsjiLtFiLtniLuJiLuriLvNiLvviLwBiMwjiMxFiMxniMyJiMyriMzNiMzviM0BiN0jiN1FiN1niN2JiN2riN3NiN3viN4BiO4jiO5FiO5niO6JiO6riO7NiO7viO8BiP8jiP9FiP9niP+JiP+riP/NiP/viPABmQAjmQBFmQBnmQCJmQCrmQDNmQDvmQEBmREjmRFFmRFnmRGJmRGrmRHNmRHvmRIBmSIjmSJFmSJnmSKJmSKrmSLNmSLvmSMBmTMjmTNFmTNnmTOJmTOrmTPNmTPvmTQBmUQjmURFmURnmUSJmUSrmUTNmUTvmUUBmVUjmVVFmVVnmVWJmVWrmVXNmVXvmVYBmWYjmWZFmWZnmWaJmWarmWbNmWbvmWcBmXcjmXdFmXdnmXeJmXermXfNmXfvmXgBmYgjmYhFmYhnmYiJmYirmYjNmYjvmYkBmZkjmZlFmZlnmZmJmZmrmZnNmZnvmZoBmaohmZCQAAOw==";
        lightOffSrc =
          // "data:image/png;base64,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";
          // "data:image/webp;base64,UklGRhoLAgBXRUJQVlA4WAoAAAAwAAAAogUA/wcASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAA... ";
          // "data:image/png;base64,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";
          diPollingCount = 0;
        doPollingCount = 0;
        diPolling = 0;
        doPolling = 0;
        diFailCount = 0;
        doFailCount = 0;
        diWaitCount = 0;
        doWaitCount = 0;

        for (var iCh = 0; iCh < diTotal; iCh++) {
          diStatus[iCh] = 0;
          document.getElementById("DI" + iCh).src = lightOffSrc;
        }
        //
        for (var iCh = 0; iCh < doTotal; iCh++) {
          doStatus[iCh] = 0;
          document.getElementById("DO" + iCh).src = lightOffSrc;
        }
        //
        canvas = document.getElementById("adamCanvas");
        try {
          ctx = canvas.getContext("2d");
          canvas.width = document.getElementById("TBL0").offsetWidth;
          canvas.height =
            padSize * 2 + gridSize * (diTotal + doTotal) + gridSize / 2;
          // deal with data
          cntMaxTotal =
            Math.floor((canvas.clientWidth - padSize * 2) / stepSize) + 1;
          cntTotal = 0;
          cntIndex = 0;
        } catch (e) {
          ctx = null;
          alert(
            "Your browser doesn't support Canvas! The historical data will not be shown!"
          );
        }
      }

      function AdamTrend_DrawLabel() {
        var iCnt, x, y1, y2;

        diDataArray = new Array(diTotal);
        doDataArray = new Array(doTotal);
        ctx.font = fontSize + "px Arial";
        // new data array & draw label
        x = canvas.width - padSize + 1;
        y1 = padSize + (gridSize + fontSize) / 2;
        for (var iCh = 0; iCh < diTotal; iCh++) {
          diDataArray[iCh] = new Array(cntMaxTotal);
          y2 = y1 + gridSize * iCh;
          ctx.fillText("DI-" + iCh, 0, y2);
          ctx.fillText("DI-" + iCh, x, y2);
        }
        // new data array & draw label
        y1 = padSize + gridSize * diTotal + (gridSize + fontSize) / 2;
        for (var iCh = 0; iCh < doTotal; iCh++) {
          doDataArray[iCh] = new Array(cntMaxTotal);
          y2 = y1 + gridSize * iCh;
          ctx.fillText("DO-" + iCh, 0, y2);
          ctx.fillText("DO-" + iCh, x, y2);
        }
        // draw buttom label
        y1 = canvas.clientHeight - padSize;
        y2 = y1 + 10;
        x = canvas.clientWidth - padSize;
        ctx.fillStyle = "#000000";
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = 1;
        iCnt = 0;
        while (x >= padSize) {
          ctx.beginPath();
          ctx.moveTo(x, y1);
          ctx.lineTo(x, y2);
          ctx.stroke();
          if (iCnt < 10) ctx.fillText(iCnt, x - 3, y2 + fontSize + 2);
          else ctx.fillText(iCnt, x - 6, y2 + fontSize + 2);
          //
          iCnt += Math.floor(
            (((gridSize * 2) / stepSize) * scanInterval) / 1000
          );
          x -= gridSize * 2;
        }
      }

      function AdamTrend_UpdateData() {
        if (cntTotal == 0) {
          cntIndex = 0;
          cntTotal = 1;
        } else if (cntTotal < cntMaxTotal) {
          cntTotal++;
          cntIndex++;
        } else {
          if (cntIndex < cntMaxTotal - 1) cntIndex++;
          else cntIndex = 0;
        }
        //
        for (var iCh = 0; iCh < diTotal; iCh++)
          diDataArray[iCh][cntIndex] = diStatus[iCh];
        for (var iCh = 0; iCh < doTotal; iCh++)
          doDataArray[iCh][cntIndex] = doStatus[iCh];
      }

      function AdamTrend_RefreshDataLine(iType, iCh) {
        var iCnt, iIdx, x, yOn, yOff;
        var preX, preVal, val;
        var y = new Array(2);
        if (cntTotal > 1) {
          if (iType == 0) {
            // DI
            y[0] = padSize + gridSize + gridSize * iCh; // channel OFF
            y[1] = padSize + gridSize + gridSize * iCh - gridSize / 2; // channel ON
            ctx.strokeStyle = "#FFA500";
            ctx.fillStyle = "#FFA500";
          } else {
            y[0] = padSize + gridSize * (diTotal + 1) + gridSize * iCh; // channel OFF
            y[1] =
              padSize +
              gridSize * (diTotal + 1) +
              gridSize * iCh -
              gridSize / 2; // channel ON
            ctx.strokeStyle = "#FF3300";
            ctx.fillStyle = "#FF3300";
          }
          iCnt = 0;
          iIdx = cntIndex;
          ctx.lineWidth = 1;
          ctx.beginPath();
          while (iCnt < cntTotal) {
            x = canvas.clientWidth - padSize - stepSize * iCnt - 1;
            if (x < padSize) x = padSize;
            if (iType == 0)
              // DI
              val = diDataArray[iCh][iIdx];
            else val = doDataArray[iCh][iIdx];
            //
            if (iCnt == 0) ctx.moveTo(x, y[val]);
            else {
              if (preVal == val) ctx.lineTo(x, y[val]);
              else {
                ctx.lineTo(preX, y[val]);
                ctx.lineTo(x, y[val]);
              }
              // to fill high part
              if (val == 1) ctx.fillRect(x, y[1], stepSize, gridSize / 2 + 1);
            }
            //
            preX = x;
            preVal = val;
            if (iIdx == 0) iIdx = cntTotal - 1;
            else iIdx--;
            iCnt++;
          }
          ctx.stroke();
        }
      }

      function AdamTrend_RefreshCanvas() {
        // Fill with gradient
        ctx.fillStyle = "#FFFAFA";
        ctx.fillRect(
          padSize,
          padSize,
          canvas.clientWidth - padSize * 2,
          canvas.clientHeight - padSize * 2
        );
        // draw row
        ctx.strokeStyle = "#DCDCDC"; //"#E6E6FA";
        ctx.lineWidth = 1;
        for (
          var y = padSize;
          y < canvas.clientHeight - padSize;
          y += gridSize
        ) {
          ctx.beginPath();
          ctx.moveTo(padSize, y);
          ctx.lineTo(canvas.clientWidth - padSize, y);
          ctx.stroke();
        }
        // draw column
        for (
          var x = canvas.clientWidth - padSize - columnInc;
          x > padSize;
          x -= gridSize
        ) {
          ctx.beginPath();
          ctx.moveTo(x, padSize);
          ctx.lineTo(x, canvas.clientHeight - padSize);
          ctx.stroke();
        }
        columnInc += stepSize;
        if (columnInc >= gridSize) columnInc -= gridSize;
        // draw data line
        for (var iCh = 0; iCh < diTotal; iCh++)
          AdamTrend_RefreshDataLine(0, iCh);
        for (var iCh = 0; iCh < doTotal; iCh++)
          AdamTrend_RefreshDataLine(1, iCh);
        // draw border
        ctx.strokeStyle = "#E6E6FA";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(padSize - 1, padSize - 1);
        ctx.lineTo(canvas.clientWidth - padSize + 1, padSize - 1);
        ctx.lineTo(
          canvas.clientWidth - padSize + 1,
          canvas.clientHeight - padSize + 1
        );
        ctx.lineTo(padSize - 1, canvas.clientHeight - padSize + 1);
        ctx.lineTo(padSize - 1, padSize - 1);
        ctx.stroke();
      }

      function pageOnInit() {
        AdamTrend_Init();
        if (ctx != null) AdamTrend_DrawLabel();

        // Cek apakah ada log yang tersimpan di localStorage
        var savedLog = localStorage.getItem("adam_last_log");
        if (savedLog) {
          var logBox = document.getElementById("logBox");
          logBox.value = savedLog + "\n" + logBox.value;

          // Hanya update status terakhir disimpan tanpa download
          var lastSaveTime = localStorage.getItem("adam_last_log_time");
          if (lastSaveTime) {
            document.getElementById("lastSaveTime").innerHTML =
              "Terakhir disimpan: " +
              new Date(lastSaveTime.replace(/-/g, ":")).toLocaleTimeString() +
              " (Loaded)";
          }
        }

        // Mulai timer untuk polling
        pageOnTimer();
      }

      function pageOnTimer() {
        httpGetDiData();
        httpGetDoData();
        if (ctx != null) {
          AdamTrend_UpdateData();
          AdamTrend_RefreshCanvas();
        }
        pageUpdateLights();
        checkAutoSave(); // Cek untuk autosave

        if (diFailCount == maxFail) {
          document.getElementById("BTN0").disabled = true;
          // Hanya simpan ke localStorage tanpa download untuk kasus error
          saveLogToFile(false);
          alert(
            "DI polling has failed " + maxFail + " times, polling suspended!"
          );
        } else if (doFailCount == maxFail) {
          document.getElementById("BTN0").disabled = true;
          // Hanya simpan ke localStorage tanpa download untuk kasus error
          saveLogToFile(false);
          alert(
            "DO polling has failed " + maxFail + " times, polling suspended!"
          );
        } else
          setTimeout(function () {
            pageOnTimer();
          }, scanInterval);
      }

      function updateLogBox(type, channel, value) {
        var logBox = document.getElementById("logBox");
        var timestamp = new Date().toLocaleTimeString();

        // Format untuk DI/DO saja, hapus format untuk rule
        var status = value == 1 ? "ACTIVE" : "INACTIVE";
        var logEntry =
          timestamp + " - " + type + channel + " is " + status + "\n";

        logBox.value = logEntry + logBox.value;

        // Tambahkan log error jika terjadi masalah koneksi
        if (diFailCount > 0 || doFailCount > 0) {
          var errorEntry =
            timestamp + " - CONNECTION ERROR: Device may be disconnected\n";
          logBox.value = errorEntry + logBox.value;
        }
      }

      function pageUpdateLights() {
        for (var iCh = 0; iCh < diTotal; iCh++) {
          if (
            document.getElementById("DI" + iCh).alt == "0" &&
            diStatus[iCh] == 1
          ) {
            document.getElementById("DI" + iCh).alt = "1";
            document.getElementById("DI" + iCh).src = Src;
            updateLogBox("DI", iCh, 1);
          } else if (
            document.getElementById("DI" + iCh).alt == "1" &&
            diStatus[iCh] == 0
          ) {
            document.getElementById("DI" + iCh).alt = "0";
            document.getElementById("DI" + iCh).src = lightOffSrc;
            updateLogBox("DI", iCh, 0);
          }
        }
        for (var iCh = 0; iCh < doTotal; iCh++) {
          if (
            document.getElementById("DO" + iCh).alt == "0" &&
            doStatus[iCh] == 1
          ) {
            document.getElementById("DO" + iCh).alt = "1";
            document.getElementById("DO" + iCh).src = Src;
            updateLogBox("DO", iCh, 1);
          } else if (
            document.getElementById("DO" + iCh).alt == "1" &&
            doStatus[iCh] == 0
          ) {
            document.getElementById("DO" + iCh).alt = "0";
            document.getElementById("DO" + iCh).src = lightOffSrc;
            updateLogBox("DO", iCh, 0);
          }
        }
      }

      function pageOnCbxClick(iDo) {
        var bAll = true;
        if (iDo == 99) {
          for (var iCh = 0; iCh < doTotal; iCh++)
            document.getElementById("CHK" + iCh).checked =
              document.getElementById("ALL").checked;
        } else {
          for (var iCh = 0; iCh < doTotal; iCh++) {
            if (document.getElementById("CHK" + iCh).checked == false) {
              bAll = false;
              break;
            }
          }
          document.getElementById("ALL").checked = bAll;
        }
      }

      function pageOnApplyClick() {
        var szPostData = "";
        var xmlHttp = null;

        for (var iCh = 0; iCh < doTotal; iCh++) {
          if (document.getElementById("CHK" + iCh).checked)
            szPostData += "DO" + iCh + "=1";
          else szPostData += "DO" + iCh + "=0";
          if (iCh < doTotal - 1) szPostData += "&";
        }
        try {
          if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlHttp = new XMLHttpRequest();
          } else {
            // code for IE6, IE5
            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
          xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4) {
              if (xmlHttp.status == 200) {
                xmlDoc = xmlHttp.responseXML;
                if (xmlDoc.documentElement.attributes[0].nodeValue != "OK")
                  alert(
                    "Set DO failed! " +
                      xmlDoc.documentElement.attributes[0].nodeValue
                  );
              } else alert(" DoOutErr:" + xmlHttp.status + "!");
            }
          };
          xmlHttp.open("POST", "digitaloutput/all/value", true);
          xmlHttp.send(szPostData);
        } catch (e) {
          alert(e);
        }
      }

      function httpGetDiData() {
        var xmlHttp = null;

        try {
          if (diPolling == 0) {
            diWaitCount = 0;
            if (window.XMLHttpRequest) {
              // code for IE7+, Firefox, Chrome, Opera, Safari
              xmlHttp = new XMLHttpRequest();
            } else {
              // code for IE6, IE5
              xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlHttp.onreadystatechange = function () {
              var szPoll;
              var xmlDoc;
              var diRecords;
              var iCh;

              if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                  xmlDoc = xmlHttp.responseXML;
                  if (xmlDoc.documentElement.attributes[0].nodeValue == "OK") {
                    diRecords = xmlDoc.getElementsByTagName("DI");
                    if (diRecords != null) {
                      for (var iCnt = 0; iCnt < diRecords.length; iCnt++) {
                        iCh =
                          diRecords[iCnt].getElementsByTagName("ID")[0]
                            .childNodes[0].nodeValue;
                        if (iCh < diTotal)
                          diStatus[iCh] =
                            diRecords[iCnt].getElementsByTagName(
                              "VALUE"
                            )[0].childNodes[0].nodeValue;
                      }
                    } else
                      document.getElementById("DIPOLL").innerHTML +=
                        " DiErr0:DI null!";
                  } else
                    document.getElementById("DIPOLL").innerHTML +=
                      " DiErr1:" +
                      xmlDoc.documentElement.attributes[0].nodeValue +
                      "!";
                } else
                  document.getElementById("DIPOLL").innerHTML +=
                    " DiErr2:" + xmlHttp.status + "!";
                diPolling = 0;
                diFailCount = 0; // reset fail count
              }
            };
            xmlHttp.open("GET", "digitalinput/all/value", true);
            xmlHttp.send();
            diPolling = 1;
            diPollingCount++;
            document.getElementById("DIPOLL").innerHTML =
              "Polling " + diPollingCount + " times...";
          } else {
            diWaitCount++;
            if (diWaitCount == maxWait) {
              diFailCount++;
              if (diFailCount < maxFail) {
                diPolling = 0; // resend
              }
            }
          }
        } catch (e) {
          diPolling = 0;
          document.getElementById("DIPOLL").innerHTML = "DiErr3:" + e + "!";
        }
      }

      function httpGetDoData() {
        var xmlHttp = null;

        try {
          if (doPolling == 0) {
            doWaitCount = 0;
            if (window.XMLHttpRequest) {
              // code for IE7+, Firefox, Chrome, Opera, Safari
              xmlHttp = new XMLHttpRequest();
            } else {
              // code for IE6, IE5
              xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlHttp.onreadystatechange = function () {
              var szPoll;
              var xmlDoc;
              var doRecords;
              var iCh;

              if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                  xmlDoc = xmlHttp.responseXML;
                  if (xmlDoc.documentElement.attributes[0].nodeValue == "OK") {
                    doRecords = xmlDoc.getElementsByTagName("DO");
                    if (doRecords != null) {
                      for (var iCnt = 0; iCnt < doRecords.length; iCnt++) {
                        iCh =
                          doRecords[iCnt].getElementsByTagName("ID")[0]
                            .childNodes[0].nodeValue;
                        if (iCh < doTotal)
                          doStatus[iCh] =
                            doRecords[iCnt].getElementsByTagName(
                              "VALUE"
                            )[0].childNodes[0].nodeValue;
                      }
                    } else
                      document.getElementById("DOPOLL").innerHTML +=
                        " DoErr1:DO null!";
                  } else
                    document.getElementById("DOPOLL").innerHTML +=
                      " DoErr1:" +
                      xmlDoc.documentElement.attributes[0].nodeValue +
                      "!";
                } else
                  document.getElementById("DOPOLL").innerHTML +=
                    " DoErr2:" + xmlHttp.status + "!";
                doPolling = 0;
                doFailCount = 0; // reset fail count
              }
            };
            xmlHttp.open("GET", "digitaloutput/all/value", true);
            xmlHttp.send();
            doPolling = 1;
            doPollingCount++;
            document.getElementById("DOPOLL").innerHTML =
              "Polling " + doPollingCount + " times...";
          } else {
            doWaitCount++;
            if (doWaitCount == maxWait) {
              doFailCount++;
              if (doFailCount < maxFail) {
                doPolling = 0; // resend
              }
            }
          }
        } catch (e) {
          doPolling = 0;
          document.getElementById("DOPOLL").innerHTML = "DoErr3:" + e + "!";
        }
      }

      // Fungsi untuk autosave setiap menit
      function checkAutoSave() {
        var currentTime = Date.now();
        if (currentTime - lastAutoSaveTime >= 60000) {
          // 60000 ms = 1 menit
          saveLogToFile(false); // Gunakan false agar tidak mendownload file
          lastAutoSaveTime = currentTime;
        }
      }

      // Mendeteksi refresh dengan menambahkan event listener untuk keydown
      document.addEventListener("keydown", function (e) {
        // Deteksi F5 atau Ctrl+R
        if (e.key === "F5" || (e.ctrlKey && e.key === "r")) {
          isRefreshing = true;
        }
      });

      // Mendeteksi klik tombol refresh di browser
      window.addEventListener("pageshow", function (e) {
        if (e.persisted) {
          // Halaman dimuat dari cache (back/forward navigation)
          isRefreshing = false;
        }
      });

      // Modifikasi event beforeunload
      window.addEventListener("beforeunload", function (e) {
        var logContent = document.getElementById("logBox").value;

        // Selalu simpan ke localStorage
        saveLogToFile(false);

        // Jika ada log dan bukan refresh (close browser/tab)
        if (logContent && !isRefreshing) {
          e.preventDefault();
          e.returnValue = "Apakah Anda ingin menyimpan log sebelum keluar?";

          // Hanya download jika benar-benar menutup browser/tab
          // Fungsi saveLogToFile sudah memeriksa isRefreshing
          saveLogToFile(true);
        }
      });

      // Event listener untuk tombol Save Log
      document
        .getElementById("saveLogBtn")
        .addEventListener("click", function () {
          saveLogToFile(true); // Force download saat tombol diklik
        });

      // Pastikan event listener terpasang setelah DOM selesai dimuat
      window.addEventListener("load", function () {
        // Pastikan tombol Save Log memiliki event listener
        document
          .getElementById("saveLogBtn")
          .addEventListener("click", function () {
            saveLogToFile(true); // Force download saat tombol diklik
          });
      });

      // Fungsi untuk mengatur status DO
      function setDOStatus(channel, value) {
        if (channel < doTotal) {
          // Persiapkan data untuk dikirim
          var szPostData = "DO" + channel + "=" + value;

          try {
            var xmlHttp = null;
            if (window.XMLHttpRequest) {
              xmlHttp = new XMLHttpRequest();
            } else {
              xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }

            xmlHttp.onreadystatechange = function () {
              if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                  xmlDoc = xmlHttp.responseXML;
                  if (xmlDoc.documentElement.attributes[0].nodeValue != "OK") {
                    console.log(
                      "Set DO failed! " +
                        xmlDoc.documentElement.attributes[0].nodeValue
                    );
                  } else {
                    // Update status lokal jika berhasil
                    doStatus[channel] = value;
                    document.getElementById("DO" + channel).alt = value;
                    document.getElementById("DO" + channel).src =
                      value == 1 ? Src : lightOffSrc;
                  }
                } else {
                  console.log("DoOutErr:" + xmlHttp.status + "!");
                }
              }
            };

            xmlHttp.open("POST", "digitaloutput/" + channel + "/value", true);
            xmlHttp.send(szPostData);
          } catch (e) {
            console.log("Error setting DO status: " + e);
          }
        }
      }

      // Fungsi untuk tombol refresh dan fullscreen
      document
        .getElementById("refreshBtn")
        .addEventListener("click", function () {
          location.reload();
        });

      document
        .getElementById("fullscreenBtn")
        .addEventListener("click", function () {
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch((err) => {
              console.log(
                `Error attempting to enable full-screen mode: ${err.message}`
              );
            });
          } else {
            if (document.exitFullscreen) {
              document.exitFullscreen();
            }
          }
        });
    </script>
  </body>
</html>
