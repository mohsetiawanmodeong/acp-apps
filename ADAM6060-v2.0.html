<!DOCTYPE html>
<!-- saved from url=(0095)https://advdownload.advantech.com/productfile/Downloadfile1/1-2HG5MO5/ADAM6060-Version1.00.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <title>CPS - LHD</title>
    <script>
      // Definisikan loaderName di awal agar bisa digunakan segera
      var loaderName = "8200"; // Variabel untuk nama loader
      document.title = "CPS - LHD " + loaderName;
    </script>
    <style>
      /* CSS yang dioptimalkan untuk ADAM module */
      :root {
        --primary-color: #1a237e;
      }

      *,
      ::after,
      ::before {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-weight: 500;
        line-height: 1.2;
      }

      /* Topnav Styles */
      .topnav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: #0a2351;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 1000;
      }

      .topnav-left {
        display: flex;
        align-items: center;
        width: 33%;
      }

      .topnav-center {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 34%;
      }

      .topnav-center h3 {
        margin: 0;
        color: #ffd43b;
        font-size: 1.5rem;
        text-align: center;
        font-weight: bold;
      }

      .topnav-right {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        width: 33%;
      }

      .logo-trakindo {
        height: 50px;
        width: auto;
        margin-left: 10px;
      }

      .logo-freeport {
        height: 30px;
        width: auto;
        margin-right: 10px;
      }

      .nav-btn {
        background: none;
        border: none;
        color: #ffd43b;
        font-size: 1.5rem;
        cursor: pointer;
        margin-right: 10px;
      }

      .nav-btn:hover {
        color: #ffffff;
      }

      /* Container Styles */
      .container {
        display: flex;
        flex: 1;
        padding: 20px;
        gap: 20px;
        margin-top: 70px;
        margin-bottom: 60px;
        max-width: 100%;
        box-sizing: border-box;
      }

      .left-panel {
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 50%;
      }

      .right-panel {
        background: rgb(222, 222, 222);
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 50%;
        box-sizing: border-box;
        height: fit-content;
      }

      @media (max-width: 992px) {
        .container {
          flex-direction: column;
        }

        .left-panel,
        .right-panel {
          width: 100%;
        }
      }

      .status-card {
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
      }

      .loader-header,
      .log-header {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 15px;
        color: var(--primary-color);
        background-color: #ffd700;
        padding: 10px;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #currentTime {
        font-size: 14px;
        color: #666;
      }

      .current-time {
        font-size: 0.9rem;
        color: #666;
      }

      /* Loader container */
      .loader-container {
        position: relative;
        width: 100%;
        height: 350px;
        margin: 10px auto;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #000000;
        overflow: visible;
      }

      /* Zone images */
      .front-safe-zone {
        position: absolute;
        left: 8%;
        top: 50%;
        transform: translateY(-50%);
        width: 45px;
        height: auto;
        z-index: 1;
        opacity: 0.3;
        transition: opacity 0.3s ease;
        display: none;
      }

      .front-safe-zone.on {
        display: block;
        opacity: 1;
        animation: blink 1s infinite;
      }

      .rear-safe-zone {
        position: absolute;
        right: 8%;
        top: 50%;
        transform: translateY(-50%);
        width: 45px;
        height: auto;
        z-index: 1;
        opacity: 0.3;
        transition: opacity 0.3s ease;
        display: none;
      }

      .rear-safe-zone.on {
        display: block;
        opacity: 1;
        animation: blink 1s infinite;
      }

      /* Parking brake icon */
      #parkingBrakeIcon {
        position: absolute;
        top: 30px;
        right: 30px;
        width: 35px;
        height: 35px;
        z-index: 3;
        opacity: 0.3;
        transition: opacity 0.3s ease;
      }

      #parkingBrakeIcon.on {
        opacity: 1;
        animation: blink 1s infinite;
      }

      /* CSS untuk efek blinking */
      @keyframes blink {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      /* Graph container */
      .graph-container {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 0;
        overflow-x: auto;
      }

      /* Log box */
      #logBox {
        width: 100%;
        height: 350px;
        margin-bottom: 10px;
        font-family: monospace;
        font-size: 18px;
        background-color: #f5f5f5;
        color: #333;
        border: 1px solid #ccc;
        padding: 10px;
        resize: vertical;
      }

      /* Log controls */
      .log-controls {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
      }

      .save-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }

      #lastSaveTime {
        font-size: 14px;
        margin: 0;
        color: #1a237e;
      }

      #noteLogSave,
      #noteAutoSaveTime {
        font-size: 12px;
        color: #1a237e;
        font-style: italic;
        margin: 0;
      }

      #saveLogBtn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px 16px;
        background-color: #0d6efd;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        min-width: 120px;
        height: 35px;
      }

      #saveLogBtn:before {
        content: "üíæ";
        margin-right: 4px;
      }

      #toggleAutoSaveBtn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px 16px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        min-width: 120px;
        height: 35px;
        margin-right: 10px;
      }

      #toggleAutoSaveBtn.off {
        background-color: #dc3545;
      }

      .polling-info {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      /* Footer */
      .footer-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        z-index: 1000;
      }

      .footer-copyright {
        text-align: center;
        padding: 10px 0;
        color: #6c757d;
        background-color: #f8f9fa;
        border-top: 1px solid #dee2e6;
        font-size: 14px;
      }

      .footer-copyright p {
        margin: 2px 0;
      }

      /* Card loader */
      .status-card.loader-card {
        background-color: #000000;
      }

      .loader-card .polling-info {
        color: #999;
      }

      /* Loader icon */
      .loader-icon {
        position: absolute;
        width: 70px;
        height: auto;
        z-index: 2;
        transform: translateY(-5%);
      }
    </style>
  </head>
  <body onload="pageOnInit()">
    <div class="topnav">
      <div class="topnav-left">
        <!-- logo freeport base64 -->
        <!-- src="assets/logo-freeport-indonesia-base64.webp" -->
        <img
          src="data:image/webp;base64,UklGRhoFAABXRUJQVlA4WAoAAAAQAAAAxwAAIAAAQUxQSBcAAAABD/Dz/4iIQKRtszmf/POTiP5PgKz7BwBWUDgg3AQAAPAaAJ0BKsgAIQA+kUCbSKWkIqEqs7uwsBIJZQDUXXAOksyLnoB2bf1PwR8JHpeQJzHeg/0L/beU3ej7mMnX908IHYE8p7gHUC7Z+h3+cf6T0m70ygH/G/7H/2v8H+N3x3Z1PpX2Bv5b/autZ6Ev61ndRJmJOWbNwLm7gx4e9nDMwNbepwvPOKVI+sAAN28VSc9Mxicn8wp8QxC8P2DmIilZ3xPglHaGo24Lz3D71PFJjqHRzsBpIJM+zKt6POIqjtmdzmgM7tFlZFlNXz7cjCAvEFpH0LePL4LpGE0sW9wAAP74JIX+J3gP8qtGOyuCdHauaJO44ikrTxNn7qNGr0Ic/kW/id/PvnPxez9FHjNQObL/pXTwUcqd22ZhbfkONkuUYshDCcWxYDf3+oAAq7Te4VDT/fZMl2ydVqkfHr9CVV/Ja1pDlxDybQ0im1Qtw/+kZCe8IRgH4cz/M2wU//KAdGf1qlBw95t/skHuJ2w3scPYFdACR0fhEIY6rDLHbIAnP3G9QCZM4olyIPcbuJIpzLMs22oAgGRUcou8HjuV+bLUe2ltCO7Sp6/q//EI5gM0/zUm4BMDbkZf/vTdfAArxJWGFepacT0kxtXz0PaFB0qkpx9z+WQTF40yTEiGD5faWQsbzdl+ea5PTbBD1y1DWiJwd9faDkRCpe4wXHPz/8cX//kZxDxP+Uh59BOLIN1oNt7Ri/ajxYtg34C+TiVov0v0QAkd+7u1O4qWd/pIOPQkGDZAKIH4X2a7iP6mjgek//AM/+mrbOSDn2dec48yhQIT7gcPb1dtGqe1zgX4R2pyeNzYqY83t1+OV7nQJ+3aTIXRKHer6dXIXC3MiUZcH/6RgEMWPa+Xb24ernUNw8PH800HKpXVAh4gMzT2xZkQU4tWbZ0iLJ7WkHV7juSlXbs7qZv9ehOYzFf9NHHVlnDWPkcWahyWHmGN4IT6qJUcJ0GZUuTrvtRHwNcqfUTy8IV7f62X3QLQvVtRI0ZTP/KJEnBFH8E0pOrqcpYHgTijmgO91Fa/AYOow+1XMRJUnS7zxPoj08N9YPzCV1vd5Qv8ru8nqMFptOsU4/zOz5AoZXicZYDygSxNnOOLBZxQ7X5+XaEKEiq4QXszSxiJ0hruDFtOHRif8nM2xbWIdOQAO9PdZ3PJ1QY4BhjvKSf106T9gwqUpgeKSSxgpGtOxyLIKo3uKoQbi8LANmIIwRVUpZOO/DvIqfn7AY2cSJqhuEMRtWFJZyxmFR6QOJYn8FKpj5p2kynaKylKGM5N6LC4jW/I2i34pJ7C00S4MzUzDy04xDjQL+8614Eraqy3TH/BuWjLE9v0mJ6W8frUC34E7idqINIVKRxWbVOvwKqtqOjQXDO177j9SMyZxESdvUWPc6d0rM8AH/n2w/k4ySVv6MxwYUOPnhOaUl+6FPhRGT1tJgM7c5+7T2ymfBdk7vsZIxuYzpvOF2xc8AGfJ1bYSbYnbcD4LgEfXgB6KOsF5F17NelS+iqXoFSentvrrMpecJJ4cf9bfvRwYP+/tkVVbomIX5CZj67DnGZf3uxYNY9t1uh4l2pULN1pYt1GqmfiL7XbkKvm6k/qIJM7IWSC7Gf/GH02OQf80IS6KZaasq187/GGgGh8dGfIn5Dj4dojyIxAAAAAAAAA"
          alt="Freeport Logo"
          class="logo-freeport"
        />
      </div>
      <div class="topnav-center">
        <h3>
          ‚ö†Ô∏èICA CPS - LHD
          <script>
            document.write(loaderName);
          </script>
        </h3>
      </div>
      <div class="topnav-right">
        <button id="refreshBtn" class="nav-btn">‚Üª</button>
        <button id="fullscreenBtn" class="nav-btn">‚õ∂</button>
        <!-- logo trakindo base64 -->
        <!-- src="assets/logo-trakindo.webp" -->
        <img
          src="data:image/webp;base64,UklGRjAEAABXRUJQVlA4WAoAAAAQAAAAYwAAMQAAQUxQSCEAAAABFyAQSFLbH2qNiAgHMmmbmpzJKt05dkX0P1nEPke0ZxEAVlA4IOgDAAAwFACdASpkADIAPpFAmUklpCKhJdzNiLASCWYAy9Rgevcj+PJ3KMBtgPMB+yXq8egDeOPQd6WL/BVvroEPOx+dh3wGshc+c94D+zegHbOca0XTz7/TPsFfq/1jDSfy3p4+ussnYbf9/CgOxQDtbNJLplUalwSnSaReoSW0sKsnBqA23c4amTE3UdDnJVfzRMTKsPCjYbrenLwD6KzW29XzI0u6UIuF/orkAAD+/sy+XN7JawCcx/aZIIzXkbUCPY7/8N9I6Hc1YfyArx5/eto0UbNcSb3gCy16i4EdM6I3hS38W/Lo4NwaHA3DvAFnn/T/mONiK/fIO0z8HyTirb/gLcPzhsfC0dfg1/+YnmxLQbxfi8afTikJwkXqk/EHkkz7RuFVC6v8XlKsJfXEbT66/bAnyuwAPYukHjuuCoVIaoSaX4xMQv+6TIGiBSArermlXeJvKH1MvKpnrY/F+B5wvag85h9Nz72xbhMnt2n1aTFlBNGzReDRaKc6UNqNa4wJAyaCA4qY9Z1WpwYh3dVZX37nkhK8Hg/7mE5P4PKYseLxY5e2ccVG+RNoH3X5G+oUGzLJmbyIZJDXeXHZ5QUrYFpEQjK4FS8T3MrI9JAJHOMKb5ZATfvQWJs3RIGdx90ovpEKfDdez16cBaxxMSSLsEikYoTatJOX9H2bNfNuy1LOzlpcM0Qa+hKAfi9Dx5DCwTC2kwPVBlOSdwnYAYrwK7OhYZLhAmjcv1hj1sQQVQHFVyPw0pe7gqdyMCSkzBccVGJcN4vuRpByAmHuoaps7XmlOf/tJhbPsJJU90JKbZxzQ2fAEjGTqYFUnFJ5LWc9tN+Zb5+4iLyYih4weTiAsJi0agqhCpDbz/fGHd4NZytmSmNZ0Rq9dCQi8PsUx57UZw0kHZKMPgoj0A/511rvpX7BPVPKvuKdQlD/Hi9+DVRdQbrvc4axiz8gnfrsyj7WdN1BUKCsfT7nltdsfkzlNj1zhHKfOsUce94GsDSSCvMNx3pPaqtw55JWwQHetncnmFYy+ynjFDhxHTJiXmOmbaAgFB4Q2JdRjQl+WxYxN2uPoMip2vpjGWbNrN4vOLiJbbYADT5Ua/eTITfB62FBvY+mwvSmut+hSiVdItEFSJaLTIT4zzch6/e9adUrmDOjMaOOapy93csJ+MdAoL5++NWpImkA3qigJDJAfFCzyzkb4wC0VneAiQf63qI8X+yHknE/wj93j+bcH0wo6TY2t58L4eVXm5h8NmsRxk66KXI0EP+hLMnNXBnV1/6/rmbC9TKrZWBG95HQcJq+2i1nMDf+7pzYTUBZFEVFnAgpTBe8SVAAAAAA"
          alt="Trakindo Logo"
          class="logo-trakindo"
        />
      </div>
    </div>

    <div class="container">
      <div class="left-panel">
        <!-- Card loader dengan indikator yang dimodifikasi -->
        <div class="status-card loader-card">
          <div class="loader-header">LOADER STATUS</div>
          <div class="polling-info" id="DIPOLL" style="color: #ffa500">
            Digital Input: Polling 0 times...
          </div>
          <div class="polling-info" id="DOPOLL" style="color: #ff3300">
            Digital Output: Polling 0 times...
          </div>
          <div class="loader-container">
            <!-- src="assets/parking brake base64.webp" -->
            <img
              src="data:image/webp;base64,UklGRigEAABXRUJQVlA4IBwEAACQEwCdASo8ADsAPpE+m0kloyKhKhmaMLASCWwAvgmN1x4Z/c/NUs3Wp6Q4AHoL2wHmA/ZL9QPd09F3oAfsZ1ofoKeWv+t3wxfuZ6SlMk/LeQDh/ndhpNgQaarhGgeRX6wTTxzE1MDCZu+pUxEjfr8k98VrXRa3LGcArZ5tSA1xIVzTtxZ49vjv0IxfQhWG8LwsJ6mv7KNtJ1/B8+gGDrRKMQIXMGAA/uvKg0mfmdEopLu1tEiDswxf+F3pnyK9BGP1DI3FVrl18LleH+/9JH5S+f92T/2yf+2T+UxaXaAzNML0CBartiPY9pg+OtcAean6/df+CAaP79/wN/GLUMZKGxWkadPRN86CXENPkUrTmdpbDwCnZCJHplIL/6MZjdkH2lwxba1LP5qXnL5ik5JcCHc6HnzsasVXwl6//Ur/Wf4JxN65/0z2uIbYtlf3/w7keu49UtiP4X3K+8hCFcSmwshqvmGUKV/L9xBuoOFpggHQa/oS86iXZTePUf9gYALrBWdCEaZorhLhvgBh393YRbjX8vkOC5x39DhRcUbNBEK/WnzKVr2h/hy5/RHo/CdmHzl8nfF8vvNI7kh+3kECsdcqUdvE+9PVh5eQ/qQ/jf+A9H3K75DdEQMZKRJAwtda5L+HJYECgAxTv/QmsygemAJL24G+QiCT4z8ldmXY+afD5r+Z+Rduqpa/Ng9Eox8NAEeluJdy2wLqxZz1o8a5/lPxvodaZhIyd4E+i3cjf8hwE24zeMC+xmmi1ZjdiWLDwU1hujSNMzqhYCDxdpL4jn4m9JvQ8evywiI+efBbrTBBlK8nNMJXZEmZe8ZP6/B2+yTQAN9gmrde4SmwizluOSjoAnv3I5QyXornN4GZ/9+Gz7Bl7t48NT5GFn7g10x5TDFylPOJbY4Idigpm6GWbiezQPfwdPaxqKOKqNcvxnZwK75UkLgyAxaN7SKZInMR3JtO6dYqXwwc0JVtThdCy5BITdquhfI6urm/Zsei1oQ2GWRolD5ZxQPYai7ui49oJSoT11xsB5pNNpYSncRpTor2xbGZPA75MoYqL92OY5+rOfSODwwF3Y/IFrtbT/ff9a9xCbK/HqQTAJx0EfKbRigCg/RCWPHPiAuqdDcgSkl4450io6gkAcU2C9KywRHJJjeZBf4wfXn87d5ZWdFmtEjq4mXy1N1ofxPDgISKYjbSkaH37gGDZEj68wy3huMO97ZvChG8WD4Wtv21BEcTrCIFkuoxd1z2RJcvncHZKz3X+sRliucGgdFsnyF7E5SXEjA3Yn9NHMASzKByeSI/0IpXd/vy3KSrCyy6s7NwCAu1lIeFZxdD+NKoYmCGV3QcMM6z40LhG8FwBkFkaXGXVY/6/Ln+/bv4GXOnr4tXKIAFurEU43jFiAAAAA=="
              id="parkingBrakeIcon"
              class="parking-brake-icon"
              alt="Parking Brake"
            />
            <!-- src="assets/front safe zone base64.webp" -->
            <img
              src="data:image/webp;base64,UklGRqQBAABXRUJQVlA4WAoAAAAQAAAAXwAABgEAQUxQSEIAAAABT6Agkg3qPf8O+s9IpYlRIyICX62ucwtFkaRGY4EXDtCADTykoiWxfj83ov8TwA+2vmoAAG6rlvwn/wl1c6yaXBFWUDggPAEAAFAPAJ0BKmAABwE+kUKdSaWjoyEnX0nosBIJTdwuPBpbs5MB/gLjAyADwAAEQJ3VD0KXXC8nEU+7cznkDuWA55BCYZv/qZlkNGLdr8RWbFOLVnO1Vjh5nNiCEwzf/UzLIaMW7X4is2KcWrOdqrHDzObEEJhm/9smaQWze2KRkbn0kmvwAPnYPj3I596ZtOGfuDYOGadBSre1JDBXmlPM7ueX5ocucGP9tSUS89gy8NjVV+mr/E7U3/x1F+FRRd4ck/y3rolf4+l0VaxhkfWrHVAqgmUthpN//TcvDQpf+54UDgSFnciRbmh6Ipw6CI9shAS1DdxJTh0ER7ZCAlqG7iSnDoI0Art9b/a/k3PUa24b/Ce9If80/5/4txvf/UMWZ/Z+s4RC73COhyrFc0YK/4uH5uf/6NH//0iMyAA="
              id="frontSafeZone"
              class="front-safe-zone"
              alt="Front Safe Zone"
            />
            <!-- src="assets/loader only base64.webp" -->
            <img
              src="data:image/webp;base64,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"
              alt="Loader"
              class="loader-icon"
            />
            <!-- src="assets/rear safe zone base64.webp" -->
            <img
              src="data:image/webp;base64,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"
              id="rearSafeZone"
              class="rear-safe-zone"
              alt="Rear Safe Zone"
            />
          </div>
          <!-- Hidden elements untuk DI dan DO status -->
          <div style="display: none">
            <img id="DI0" src="" alt="0" class="status-light" />
            <img id="DI2" src="" alt="0" class="status-light" />
            <img id="DO0" src="" alt="0" class="status-light" />
          </div>
        </div>

        <div class="graph-container">
          <table id="TBL0" style="width: 100%">
            <tr>
              <td>
                <canvas id="adamCanvas"></canvas>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div class="right-panel">
        <div class="log-header">
          <span>SYSTEM LOG</span>
          <span id="currentTime" class="current-time"></span>
        </div>
        <textarea id="logBox" readonly></textarea>
        <div class="log-controls">
          <div class="save-info">
            <div id="lastSaveTime">
              Terakhir disimpan: Invalid Date (Loaded)
            </div>
            <div id="noteLogSave">
              *Log akan disimpan saat menutup browser/tab
            </div>
            <div id="noteAutoSaveTime">
              *Log akan disimpan otomatis setiap 5 menit
            </div>
          </div>
          <div>
            <button id="toggleAutoSaveBtn">AutoSave: ON</button>
            <button id="saveLogBtn">SAVE LOG</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-container">
      <div class="footer-copyright">
        <p>Collision Prevention System v2.0</p>
        <p>Copyright &copy; 2025 by Trakindo Technology Dept.</p>
      </div>
    </div>

    <script>
      var canvas;
      var ctx;
      var scanInterval = 1000;
      var diTotal = 3; // Ubah dari 2 menjadi 3 untuk menampilkan DI 0, DI 1, dan DI 2
      var doTotal = 1;
      var padSize = 30;
      var gridSize = 16;
      var columnInc = 0;
      var stepSize = 8;
      var fontSize = 10;
      var lightOnSrc, lightOffSrc;
      var diStatus;
      var doStatus;
      var cntMaxTotal, cntIndex, cntTotal;
      var diDataArray;
      var doDataArray;
      var diPolling, diPollingCount;
      var doPolling, doPollingCount;
      var diFailCount, diWaitCount;
      var doFailCount, doWaitCount;
      var maxWait = 5;
      var maxFail = 3;
      var lastAutoSaveTime = Date.now();
      var autoSaveEnabled =
        localStorage.getItem("autoSaveEnabled") === "false" ? false : true; // Default to true if not set

      // Variabel untuk mendeteksi refresh
      var isRefreshing = false;

      // Pendekatan yang lebih sederhana untuk mendeteksi refresh
      // Cek apakah ini adalah refresh
      var lastPageLoadTime = localStorage.getItem("lastPageLoadTime");
      var currentTime = new Date().getTime();

      if (lastPageLoadTime && currentTime - lastPageLoadTime < 3000) {
        // Jika waktu antara load terakhir dan sekarang kurang dari 3 detik, ini adalah refresh
        isRefreshing = true;
        console.log("Detected page refresh");
      }

      // Simpan waktu load saat ini
      localStorage.setItem("lastPageLoadTime", currentTime);

      // Tambahkan flag untuk menandai bahwa halaman sedang dimuat
      localStorage.setItem("pageIsLoading", "true");

      // Setelah halaman selesai dimuat, hapus flag
      window.addEventListener("load", function () {
        localStorage.removeItem("pageIsLoading");
      });

      // Fungsi untuk menyimpan log ke file
      function saveLogToFile(forceDownload = false) {
        var logContent = document.getElementById("logBox").value;
        if (!logContent && !forceDownload) return;

        // Format tanggal dan waktu untuk nama file
        var now = new Date();
        var year = now.getFullYear();
        var month = String(now.getMonth() + 1).padStart(2, "0");
        var day = String(now.getDate()).padStart(2, "0");
        var hours = String(now.getHours()).padStart(2, "0");
        var minutes = String(now.getMinutes()).padStart(2, "0");
        var seconds = String(now.getSeconds()).padStart(2, "0");

        var dateTimeString =
          year +
          "-" +
          month +
          "-" +
          day +
          "-" +
          hours +
          "_" +
          minutes +
          "_" +
          seconds;
        var filename = "cps_log_" + loaderName + "_" + dateTimeString + ".txt";

        // Simpan ke localStorage
        try {
          localStorage.setItem("adam_last_log", logContent);
          localStorage.setItem("adam_last_log_time", dateTimeString);
          document.getElementById("lastSaveTime").innerHTML =
            "Terakhir disimpan: " + now.toLocaleTimeString() + " (Autosaved)";
        } catch (e) {
          console.error("Failed to save to localStorage:", e);
          document.getElementById("lastSaveTime").innerHTML =
            "Error saat menyimpan: " + e.message;
        }

        // Download file jika diminta dan belum ada download yang sedang berlangsung
        if (forceDownload) {
          // Tambahkan flag untuk mencegah multiple download
          if (window.isDownloading) return;
          window.isDownloading = true;

          try {
            var blob = new Blob([logContent], {
              type: "text/plain;charset=utf-8",
            });
            var url = window.URL.createObjectURL(blob);
            var link = document.createElement("a");
            link.href = url;
            link.download = filename;

            // Gunakan setTimeout untuk memastikan download selesai sebelum cleanup
            setTimeout(function () {
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              window.URL.revokeObjectURL(url);
              window.isDownloading = false;

              document.getElementById("lastSaveTime").innerHTML =
                "Terakhir disimpan: " +
                now.toLocaleTimeString() +
                " (Downloaded)";

              // Tampilkan alert setelah download selesai
              setTimeout(function () {
                alert("File log berhasil disimpan!");
              }, 500);
            }, 100);
          } catch (e) {
            console.error("Error saat menyimpan file:", e);
            alert("Error saat menyimpan file: " + e.message);
            window.isDownloading = false;
          }
        }
      }

      function AdamTrend_Init() {
        diStatus = new Array(diTotal);
        doStatus = new Array(doTotal);
        diPollingCount = 0;
        doPollingCount = 0;
        diPolling = 0;
        doPolling = 0;
        diFailCount = 0;
        doFailCount = 0;
        diWaitCount = 0;
        doWaitCount = 0;

        for (var iCh = 0; iCh < diTotal; iCh++) {
          diStatus[iCh] = 0;
          if (document.getElementById("DI" + iCh)) {
            document.getElementById("DI" + iCh).src = lightOffSrc;
          }
        }
        //
        for (var iCh = 0; iCh < doTotal; iCh++) {
          doStatus[iCh] = 0;
          if (document.getElementById("DO" + iCh)) {
            document.getElementById("DO" + iCh).src = lightOffSrc;
          }
        }
        //
        canvas = document.getElementById("adamCanvas");
        try {
          ctx = canvas.getContext("2d");
          canvas.width = document.getElementById("TBL0").offsetWidth;
          // Menghitung tinggi canvas yang sesuai berdasarkan jumlah channel aktif
          var activeChannels = 2; // DI-0 dan DI-2
          var totalChannels = activeChannels + doTotal; // Tambah DO-0
          canvas.height = padSize * 2 + gridSize * totalChannels;

          // deal with data
          cntMaxTotal =
            Math.floor((canvas.clientWidth - padSize * 2) / stepSize) + 1;
          cntTotal = 0;
          cntIndex = 0;
        } catch (e) {
          ctx = null;
          alert(
            "Your browser doesn't support Canvas! The historical data will not be shown!"
          );
        }
      }

      function AdamTrend_DrawLabel() {
        var iCnt, x, y1, y2;

        diDataArray = new Array(diTotal);
        doDataArray = new Array(doTotal);
        ctx.font = fontSize + "px Arial";

        // new data array & draw label
        x = canvas.width - padSize + 1;
        y1 = padSize + (gridSize + fontSize) / 2;

        // Gambar label untuk DI-0 dan DI-2 dengan spacing yang lebih rapi
        var activeChannels = 0;
        for (var iCh = 0; iCh < diTotal; iCh++) {
          diDataArray[iCh] = new Array(cntMaxTotal);
          if (iCh !== 1) {
            // Skip DI-1
            y2 = y1 + gridSize * activeChannels;
            ctx.fillText("DI-" + iCh, 0, y2);
            ctx.fillText("DI-" + iCh, x, y2);
            activeChannels++;
          }
        }

        // Gambar label untuk DO-0 dengan posisi yang sesuai
        y1 = padSize + gridSize * 2 + (gridSize + fontSize) / 2;
        for (var iCh = 0; iCh < doTotal; iCh++) {
          doDataArray[iCh] = new Array(cntMaxTotal);
          y2 = y1;
          ctx.fillText("DO-" + iCh, 0, y2);
          ctx.fillText("DO-" + iCh, x, y2);
        }

        // draw bottom label
        y1 = canvas.clientHeight - padSize;
        y2 = y1 + 10;
        x = canvas.clientWidth - padSize;
        ctx.fillStyle = "#000000";
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = 1;
        iCnt = 0;
        while (x >= padSize) {
          ctx.beginPath();
          ctx.moveTo(x, y1);
          ctx.lineTo(x, y2);
          ctx.stroke();
          if (iCnt < 10) ctx.fillText(iCnt, x - 3, y2 + fontSize + 2);
          else ctx.fillText(iCnt, x - 6, y2 + fontSize + 2);
          iCnt += Math.floor(
            (((gridSize * 2) / stepSize) * scanInterval) / 1000
          );
          x -= gridSize * 2;
        }
      }

      function AdamTrend_UpdateData() {
        if (cntTotal == 0) {
          cntIndex = 0;
          cntTotal = 1;
        } else if (cntTotal < cntMaxTotal) {
          cntTotal++;
          cntIndex++;
        } else {
          if (cntIndex < cntMaxTotal - 1) cntIndex++;
          else cntIndex = 0;
        }
        //
        for (var iCh = 0; iCh < diTotal; iCh++)
          diDataArray[iCh][cntIndex] = diStatus[iCh];
        for (var iCh = 0; iCh < doTotal; iCh++)
          doDataArray[iCh][cntIndex] = doStatus[iCh];
      }

      function AdamTrend_RefreshDataLine(iType, iCh) {
        var iCnt, iIdx, x, yOn, yOff;
        var preX, preVal, val;
        var y = new Array(2);
        if (cntTotal > 1) {
          if (iType == 0) {
            // DI
            // Hitung posisi y berdasarkan channel yang aktif
            var activeChannelIndex = iCh === 0 ? 0 : 1; // DI-0 = index 0, DI-2 = index 1
            y[0] = padSize + gridSize + gridSize * activeChannelIndex; // channel OFF
            y[1] =
              padSize + gridSize + gridSize * activeChannelIndex - gridSize / 2; // channel ON
            ctx.strokeStyle = "#FFA500";
            ctx.fillStyle = "#FFA500";
          } else {
            // DO
            y[0] = padSize + gridSize * 3; // Posisi tetap untuk DO-0
            y[1] = padSize + gridSize * 3 - gridSize / 2;
            ctx.strokeStyle = "#FF3300";
            ctx.fillStyle = "#FF3300";
          }

          iCnt = 0;
          iIdx = cntIndex;
          ctx.lineWidth = 1;
          ctx.beginPath();
          while (iCnt < cntTotal) {
            x = canvas.clientWidth - padSize - stepSize * iCnt - 1;
            if (x < padSize) x = padSize;
            if (iType == 0) val = diDataArray[iCh][iIdx];
            else val = doDataArray[iCh][iIdx];

            if (iCnt == 0) ctx.moveTo(x, y[val]);
            else {
              if (preVal == val) ctx.lineTo(x, y[val]);
              else {
                ctx.lineTo(preX, y[val]);
                ctx.lineTo(x, y[val]);
              }
              if (val == 1) ctx.fillRect(x, y[1], stepSize, gridSize / 2 + 1);
            }

            preX = x;
            preVal = val;
            if (iIdx == 0) iIdx = cntTotal - 1;
            else iIdx--;
            iCnt++;
          }
          ctx.stroke();
        }
      }

      function AdamTrend_RefreshCanvas() {
        // Fill with gradient
        ctx.fillStyle = "#FFFAFA";
        ctx.fillRect(
          padSize,
          padSize,
          canvas.clientWidth - padSize * 2,
          canvas.clientHeight - padSize * 2
        );
        // draw row
        ctx.strokeStyle = "#DCDCDC"; //"#E6E6FA";
        ctx.lineWidth = 1;
        for (
          var y = padSize;
          y < canvas.clientHeight - padSize;
          y += gridSize
        ) {
          ctx.beginPath();
          ctx.moveTo(padSize, y);
          ctx.lineTo(canvas.clientWidth - padSize, y);
          ctx.stroke();
        }
        // draw column
        for (
          var x = canvas.clientWidth - padSize - columnInc;
          x > padSize;
          x -= gridSize
        ) {
          ctx.beginPath();
          ctx.moveTo(x, padSize);
          ctx.lineTo(x, canvas.clientHeight - padSize);
          ctx.stroke();
        }
        columnInc += stepSize;
        if (columnInc >= gridSize) columnInc -= gridSize;
        // draw data line
        for (var iCh = 0; iCh < diTotal; iCh++) {
          // Skip DI-1, hanya tampilkan DI-0 dan DI-2
          if (iCh !== 1) {
            AdamTrend_RefreshDataLine(0, iCh);
          }
        }
        for (var iCh = 0; iCh < doTotal; iCh++)
          AdamTrend_RefreshDataLine(1, iCh);
        // draw border
        ctx.strokeStyle = "#E6E6FA";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(padSize - 1, padSize - 1);
        ctx.lineTo(canvas.clientWidth - padSize + 1, padSize - 1);
        ctx.lineTo(
          canvas.clientWidth - padSize + 1,
          canvas.clientHeight - padSize + 1
        );
        ctx.lineTo(padSize - 1, canvas.clientHeight - padSize + 1);
        ctx.lineTo(padSize - 1, padSize - 1);
        ctx.stroke();
      }

      function pageOnInit() {
        AdamTrend_Init();
        if (ctx != null) AdamTrend_DrawLabel();

        // Set initial status untuk DI dan DO elements
        for (var iCh = 0; iCh < diTotal; iCh++) {
          diStatus[iCh] = 0; // Inisialisasi status
          if (document.getElementById("DI" + iCh)) {
            document.getElementById("DI" + iCh).src = lightOffSrc;
            document.getElementById("DI" + iCh).alt = "0";
          }
        }

        for (var iCh = 0; iCh < doTotal; iCh++) {
          doStatus[iCh] = 0; // Inisialisasi status
          if (document.getElementById("DO" + iCh)) {
            document.getElementById("DO" + iCh).src = lightOffSrc;
            document.getElementById("DO" + iCh).alt = "0";
          }
        }

        // Set initial visibility untuk indikator
        var frontSafeZone = document.getElementById("frontSafeZone");
        var rearSafeZone = document.getElementById("rearSafeZone");
        var parkingBrakeIcon = document.getElementById("parkingBrakeIcon");

        if (frontSafeZone) {
          frontSafeZone.style.display = "none";
          frontSafeZone.classList.remove("on");
        }

        if (rearSafeZone) {
          rearSafeZone.style.display = "none";
          rearSafeZone.classList.remove("on");
        }

        if (parkingBrakeIcon) {
          parkingBrakeIcon.style.display = "none";
          parkingBrakeIcon.classList.remove("on");
        }

        // Update judul halaman dengan nama loader
        document.querySelector(".topnav-center h3").textContent =
          "‚ö†Ô∏èICA CPS - LHD " + loaderName;

        // Cek apakah ada log yang tersimpan di localStorage
        var savedLog = localStorage.getItem("adam_last_log");
        if (savedLog) {
          var logBox = document.getElementById("logBox");
          logBox.value = savedLog + "\n" + logBox.value;

          var lastSaveTime = localStorage.getItem("adam_last_log_time");
          if (lastSaveTime) {
            document.getElementById("lastSaveTime").innerHTML =
              "Terakhir disimpan: " +
              new Date(lastSaveTime.replace(/-/g, ":")).toLocaleTimeString() +
              " (Loaded)";
          }
        }

        // Debug log untuk status awal
        console.log("Initial DI status:", diStatus);
        console.log("Initial DO status:", doStatus);

        // Mulai timer untuk polling
        pageOnTimer();
      }

      function pageOnTimer() {
        httpGetDiData();
        httpGetDoData();
        if (ctx != null) {
          AdamTrend_UpdateData();
          AdamTrend_RefreshCanvas();
        }
        pageUpdateLights();
        updateIndicatorBoxes();
        checkAutoSave();

        if (diFailCount == maxFail) {
          document.getElementById("BTN0").disabled = true;
          // Hanya simpan ke localStorage tanpa download untuk kasus error
          saveLogToFile(false);
          alert(
            "DI polling has failed " + maxFail + " times, polling suspended!"
          );
        } else if (doFailCount == maxFail) {
          document.getElementById("BTN0").disabled = true;
          // Hanya simpan ke localStorage tanpa download untuk kasus error
          saveLogToFile(false);
          alert(
            "DO polling has failed " + maxFail + " times, polling suspended!"
          );
        } else
          setTimeout(function () {
            pageOnTimer();
          }, scanInterval);
      }

      function updateLogBox(type, channel, value) {
        var logBox = document.getElementById("logBox");
        var now = new Date();
        var year = now.getFullYear();
        var month = String(now.getMonth() + 1).padStart(2, "0");
        var day = String(now.getDate()).padStart(2, "0");
        var timestamp =
          year + "-" + month + "-" + day + " " + now.toLocaleTimeString();
        var message = "";

        // Format pesan berdasarkan tipe dan channel
        if (type === "DI") {
          if (channel === 0) {
            message =
              value == 1
                ? "WARNING Wall Collision FRONT ON"
                : "WARNING Wall Collision FRONT OFF";
          } else if (channel === 2) {
            message =
              value == 1
                ? "WARNING Wall Collision REAR ON"
                : "WARNING Wall Collision REAR OFF";
          }
        } else if (type === "DO" && channel === 0) {
          message =
            value == 1 ? "Parking Brake System ON" : "Parking Brake System OFF";
        }

        var logEntry = timestamp + " - " + message + "\n";
        logBox.value = logEntry + logBox.value;

        // Tambahkan log error jika terjadi masalah koneksi
        if (diFailCount > 0 || doFailCount > 0) {
          var errorEntry =
            timestamp + " - CONNECTION ERROR: Device may be disconnected\n";
          logBox.value = errorEntry + logBox.value;
        }
      }

      function pageUpdateLights() {
        for (var iCh = 0; iCh < diTotal; iCh++) {
          // Hanya proses DI0 dan DI2 (FRONT dan REAR SAFE ZONE)
          if (iCh === 0 || iCh === 2) {
            var diElement = document.getElementById("DI" + iCh);

            if (diElement) {
              if (diElement.alt == "0" && diStatus[iCh] == 1) {
                diElement.alt = "1";
                diElement.src = lightOnSrc;
                updateLogBox("DI", iCh, 1);
              } else if (diElement.alt == "1" && diStatus[iCh] == 0) {
                diElement.alt = "0";
                diElement.src = lightOffSrc;
                updateLogBox("DI", iCh, 0);
              }
            }
          }
        }

        for (var iCh = 0; iCh < doTotal; iCh++) {
          var doElement = document.getElementById("DO" + iCh);
          if (doElement) {
            if (doElement.alt == "0" && doStatus[iCh] == 1) {
              doElement.alt = "1";
              doElement.src = lightOnSrc;
              updateLogBox("DO", iCh, 1);
            } else if (doElement.alt == "1" && doStatus[iCh] == 0) {
              doElement.alt = "0";
              doElement.src = lightOffSrc;
              updateLogBox("DO", iCh, 0);
            }
          }
        }

        // Tambahkan panggilan ke updateIndicatorBoxes di akhir fungsi
        updateIndicatorBoxes();
      }

      function httpGetDiData() {
        var xmlHttp = null;

        try {
          if (diPolling == 0) {
            diWaitCount = 0;
            if (window.XMLHttpRequest) {
              xmlHttp = new XMLHttpRequest();
            } else {
              xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlHttp.onreadystatechange = function () {
              var szPoll;
              var xmlDoc;
              var diRecords;
              var iCh;

              if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                  xmlDoc = xmlHttp.responseXML;
                  if (xmlDoc.documentElement.attributes[0].nodeValue == "OK") {
                    diRecords = xmlDoc.getElementsByTagName("DI");
                    if (diRecords != null) {
                      for (var iCnt = 0; iCnt < diRecords.length; iCnt++) {
                        iCh =
                          diRecords[iCnt].getElementsByTagName("ID")[0]
                            .childNodes[0].nodeValue;
                        if (iCh < diTotal)
                          diStatus[iCh] =
                            diRecords[iCnt].getElementsByTagName(
                              "VALUE"
                            )[0].childNodes[0].nodeValue;
                      }
                      // Panggil updateIndicatorBoxes setelah update diStatus
                      updateIndicatorBoxes();
                    } else
                      document.getElementById("DIPOLL").innerHTML +=
                        " DiErr0:DI null!";
                  } else
                    document.getElementById("DIPOLL").innerHTML +=
                      " DiErr1:" +
                      xmlDoc.documentElement.attributes[0].nodeValue +
                      "!";
                } else
                  document.getElementById("DIPOLL").innerHTML +=
                    " DiErr2:" + xmlHttp.status + "!";
                diPolling = 0;
                diFailCount = 0; // reset fail count
              }
            };
            xmlHttp.open("GET", "digitalinput/all/value", true);
            xmlHttp.send();
            diPolling = 1;
            diPollingCount++;
            document.getElementById("DIPOLL").innerHTML =
              "Polling " + diPollingCount + " times...";
          } else {
            diWaitCount++;
            if (diWaitCount == maxWait) {
              diFailCount++;
              if (diFailCount < maxFail) {
                diPolling = 0;
              }
            }
          }
        } catch (e) {
          diPolling = 0;
          document.getElementById("DIPOLL").innerHTML = "DiErr3:" + e + "!";
        }
      }

      function httpGetDoData() {
        var xmlHttp = null;

        try {
          if (doPolling == 0) {
            doWaitCount = 0;
            if (window.XMLHttpRequest) {
              xmlHttp = new XMLHttpRequest();
            } else {
              xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlHttp.onreadystatechange = function () {
              var szPoll;
              var xmlDoc;
              var doRecords;
              var iCh;

              if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                  xmlDoc = xmlHttp.responseXML;
                  if (xmlDoc.documentElement.attributes[0].nodeValue == "OK") {
                    doRecords = xmlDoc.getElementsByTagName("DO");
                    if (doRecords != null) {
                      for (var iCnt = 0; iCnt < doRecords.length; iCnt++) {
                        iCh =
                          doRecords[iCnt].getElementsByTagName("ID")[0]
                            .childNodes[0].nodeValue;
                        if (iCh < doTotal)
                          doStatus[iCh] =
                            doRecords[iCnt].getElementsByTagName(
                              "VALUE"
                            )[0].childNodes[0].nodeValue;
                      }
                    } else
                      document.getElementById("DOPOLL").innerHTML +=
                        " DoErr0:DO null!";
                  } else
                    document.getElementById("DOPOLL").innerHTML +=
                      " DoErr1:" +
                      xmlDoc.documentElement.attributes[0].nodeValue +
                      "!";
                } else
                  document.getElementById("DOPOLL").innerHTML +=
                    " DoErr2:" + xmlHttp.status + "!";
                doPolling = 0;
                doFailCount = 0; // reset fail count
              }
            };
            xmlHttp.open("GET", "digitaloutput/all/value", true);
            xmlHttp.send();
            doPolling = 1;
            doPollingCount++;
            document.getElementById("DOPOLL").innerHTML =
              "Polling " + doPollingCount + " times...";
          } else {
            doWaitCount++;
            if (doWaitCount == maxWait) {
              doFailCount++;
              if (doFailCount < maxFail) {
                doPolling = 0; // resend
              }
            }
          }
        } catch (e) {
          doPolling = 0;
          document.getElementById("DOPOLL").innerHTML = "DoErr3:" + e + "!";
        }
      }

      // Fungsi untuk autosave setiap menit
      function checkAutoSave() {
        var currentTime = Date.now();
        if (autoSaveEnabled && currentTime - lastAutoSaveTime >= 300000) {
          // 300000 ms = 5 menit
          saveLogToFile(false); // Simpan ke localStorage tanpa download

          // Update status terakhir disimpan
          var now = new Date();
          document.getElementById("lastSaveTime").innerHTML =
            "Terakhir disimpan: " + now.toLocaleTimeString() + " (Autosaved)";

          // Tampilkan notifikasi kecil
          var notification = document.createElement("div");
          notification.style.position = "fixed";
          notification.style.bottom = "70px";
          notification.style.right = "20px";
          notification.style.backgroundColor = "#4CAF50";
          notification.style.color = "white";
          notification.style.padding = "10px";
          notification.style.borderRadius = "5px";
          notification.style.zIndex = "1000";
          notification.style.opacity = "0.9";
          notification.textContent = "Log berhasil disimpan otomatis";

          document.body.appendChild(notification);

          // Hilangkan notifikasi setelah 3 detik
          setTimeout(function () {
            notification.style.opacity = "0";
            notification.style.transition = "opacity 1s";
            setTimeout(function () {
              document.body.removeChild(notification);
            }, 1000);
          }, 3000);

          lastAutoSaveTime = currentTime;
        }
      }

      // Mendeteksi refresh dengan menambahkan event listener untuk keydown
      document.addEventListener("keydown", function (e) {
        // Deteksi F5 atau Ctrl+R
        if (e.key === "F5" || (e.ctrlKey && e.key === "r")) {
          isRefreshing = true;
        }
      });

      // Mendeteksi klik tombol refresh di browser
      window.addEventListener("pageshow", function (e) {
        if (e.persisted) {
          // Halaman dimuat dari cache (back/forward navigation)
          isRefreshing = false;
        }
      });

      // Modifikasi event beforeunload
      window.addEventListener("beforeunload", function (e) {
        var logContent = document.getElementById("logBox").value;

        // Jika ada log dan bukan refresh (close browser/tab)
        if (logContent && !isRefreshing) {
          e.preventDefault();
          e.returnValue = "Apakah Anda ingin menyimpan log sebelum keluar?";
          saveLogToFile(true);
        }
      });

      // Event listener untuk tombol Save Log
      document
        .getElementById("saveLogBtn")
        .addEventListener("click", function () {
          saveLogToFile(true); // Force download saat tombol diklik
        });

      // Event listener untuk tombol Toggle AutoSave
      document
        .getElementById("toggleAutoSaveBtn")
        .addEventListener("click", function () {
          autoSaveEnabled = !autoSaveEnabled;
          localStorage.setItem("autoSaveEnabled", autoSaveEnabled);
          this.textContent = autoSaveEnabled ? "AutoSave: ON" : "AutoSave: OFF";
          this.classList.toggle("off", !autoSaveEnabled);

          // Hapus notifikasi yang sudah ada (jika ada)
          var existingNotification = document.querySelector(
            ".autosave-notification"
          );
          if (existingNotification) {
            document.body.removeChild(existingNotification);
          }

          // Tampilkan notifikasi baru
          var status = autoSaveEnabled ? "diaktifkan" : "dinonaktifkan";
          var notification = document.createElement("div");
          notification.className = "autosave-notification";
          notification.style.position = "fixed";
          notification.style.bottom = "70px";
          notification.style.right = "20px";
          notification.style.backgroundColor = autoSaveEnabled
            ? "#4CAF50"
            : "#f44336";
          notification.style.color = "white";
          notification.style.padding = "10px";
          notification.style.borderRadius = "5px";
          notification.style.zIndex = "1000";
          notification.style.opacity = "0.9";
          notification.textContent = "AutoSave " + status;

          document.body.appendChild(notification);

          // Hilangkan notifikasi setelah 3 detik
          setTimeout(function () {
            if (notification && notification.parentNode) {
              notification.style.opacity = "0";
              notification.style.transition = "opacity 1s";
              setTimeout(function () {
                if (notification && notification.parentNode) {
                  document.body.removeChild(notification);
                }
              }, 1000);
            }
          }, 3000);

          // Jika diaktifkan, reset timer
          if (autoSaveEnabled) {
            lastAutoSaveTime = Date.now();
          }
        });

      // Pastikan event listener terpasang setelah DOM selesai dimuat
      window.addEventListener("load", function () {
        // Pastikan tombol Save Log memiliki event listener
        document
          .getElementById("saveLogBtn")
          .addEventListener("click", function () {
            saveLogToFile(true); // Force download saat tombol diklik
          });

        // Sesuaikan tampilan tombol dengan status yang tersimpan
        var toggleBtn = document.getElementById("toggleAutoSaveBtn");
        toggleBtn.textContent = autoSaveEnabled
          ? "AutoSave: ON"
          : "AutoSave: OFF";
        toggleBtn.classList.toggle("off", !autoSaveEnabled);
      });

      // Fungsi untuk mengatur status DO
      function setDOStatus(channel, value) {
        if (channel < doTotal) {
          // Persiapkan data untuk dikirim
          var szPostData = "DO" + channel + "=" + value;

          try {
            var xmlHttp = null;
            if (window.XMLHttpRequest) {
              xmlHttp = new XMLHttpRequest();
            } else {
              xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            }

            xmlHttp.onreadystatechange = function () {
              if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                  xmlDoc = xmlHttp.responseXML;
                  if (xmlDoc.documentElement.attributes[0].nodeValue != "OK") {
                    console.log(
                      "Set DO failed! " +
                        xmlDoc.documentElement.attributes[0].nodeValue
                    );
                  } else {
                    // Update status lokal jika berhasil
                    doStatus[channel] = value;
                    document.getElementById("DO" + channel).alt = value;
                    document.getElementById("DO" + channel).src =
                      value == 1 ? lightOnSrc : lightOffSrc;
                  }
                } else {
                  console.log("DoOutErr:" + xmlHttp.status + "!");
                }
              }
            };

            xmlHttp.open("POST", "digitaloutput/" + channel + "/value", true);
            xmlHttp.send(szPostData);
          } catch (e) {
            console.log("Error setting DO status: " + e);
          }
        }
      }

      // Fungsi untuk tombol refresh dan fullscreen
      document
        .getElementById("refreshBtn")
        .addEventListener("click", function () {
          location.reload();
        });

      document
        .getElementById("fullscreenBtn")
        .addEventListener("click", function () {
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch((err) => {
              console.log(
                `Error attempting to enable full-screen mode: ${err.message}`
              );
            });
          } else {
            if (document.exitFullscreen) {
              document.exitFullscreen();
            }
          }
        });

      // Tambahkan fungsi untuk update waktu
      function updateCurrentTime() {
        var now = new Date();
        var timeString = now.toLocaleTimeString();
        document.getElementById("currentTime").innerHTML =
          "Waktu saat ini: " + timeString;
      }

      // Panggil fungsi updateCurrentTime setiap detik
      setInterval(updateCurrentTime, 1000);
      updateCurrentTime(); // Panggil sekali saat halaman dimuat

      // Tambahkan fungsi untuk mengupdate kotak indikator
      function updateIndicatorBoxes() {
        // Update front safe zone berdasarkan diStatus[0]
        var frontSafeZone = document.getElementById("frontSafeZone");
        if (diStatus[0] == 1) {
          frontSafeZone.style.display = "block";
          frontSafeZone.classList.add("on");
        } else {
          frontSafeZone.style.display = "none";
          frontSafeZone.classList.remove("on");
        }

        // Update rear safe zone berdasarkan diStatus[2]
        var rearSafeZone = document.getElementById("rearSafeZone");
        if (diStatus[2] == 1) {
          rearSafeZone.style.display = "block";
          rearSafeZone.classList.add("on");
        } else {
          rearSafeZone.style.display = "none";
          rearSafeZone.classList.remove("on");
        }

        // Update parking brake berdasarkan doStatus[0]
        var parkingBrake = document.getElementById("parkingBrakeIcon");
        if (doStatus[0] == 1) {
          parkingBrake.style.display = "block";
          parkingBrake.classList.add("on");
        } else {
          parkingBrake.style.display = "none";
          parkingBrake.classList.remove("on");
        }
      }
    </script>
  </body>
</html>
